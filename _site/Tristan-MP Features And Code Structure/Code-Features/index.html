<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Code Features - Tristan-MP Documentation</title> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="http://localhost:4000/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="http://localhost:4000/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="http://localhost:4000/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>Code Features | Tristan-MP Documentation</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Code Features" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A wiki of Machine learning and Statistics resources useful for self-learning." /> <meta property="og:description" content="A wiki of Machine learning and Statistics resources useful for self-learning." /> <link rel="canonical" href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/Code-Features/" /> <meta property="og:url" content="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/Code-Features/" /> <meta property="og:site_name" content="Tristan-MP Documentation" /> <script type="application/ld+json"> {"headline":"Code Features","description":"A wiki of Machine learning and Statistics resources useful for self-learning.","@type":"WebPage","url":"http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/Code-Features/","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> Tristan-MP Documentation </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/GettingStarted/outline/" class="nav-list-link">Getting Started</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/GettingStarted/Logging-in-to-perseus/" class="nav-list-link">Logging into Perseus</a></li><li class="nav-list-item "><a href="http://localhost:4000/GettingStarted/Downloading-and-Compiling-Tristan/" class="nav-list-link">Compiling Tristan-MP</a></li><li class="nav-list-item "><a href="http://localhost:4000/GettingStarted/Running-your-first-Tristan-MP-simulation/" class="nav-list-link">Running Tristan-MP</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/AnalyzingSims/outline/" class="nav-list-link">Analyzing Simulations</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/AnalyzingSims/Logging-in-to-tigressdata2/" class="nav-list-link">Logging into TigressData2</a></li><li class="nav-list-item "><a href="http://localhost:4000/AnalyzingSims/Writing-your-own-python-scripts/" class="nav-list-link">Writing a python analysis script</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/Example%20Simulations/outline/" class="nav-list-link">Example Simulations</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/Example%20Simulations/Sample-shock-run/" class="nav-list-link">Shock Simulation</a></li><li class="nav-list-item "><a href="http://localhost:4000/Example%20Simulations/Sample-Weibel-run/" class="nav-list-link">Weibel Simulation</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/outline/" class="nav-list-link">Tristan-MP Features and Code Structure</a><ul class="nav-list "><li class="nav-list-item active"><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/Code-Features/" class="nav-list-link active">Code Features</a></li><li class="nav-list-item "><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/Input-Files/" class="nav-list-link">Input Files</a></li><li class="nav-list-item "><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/Compilation/" class="nav-list-link">Compiling Tristan</a></li><li class="nav-list-item "><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/Running/" class="nav-list-link">Running Tristan</a></li><li class="nav-list-item "><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/User-Files/" class="nav-list-link">User Files</a></li></ul></li><li class="nav-list-item"><a href="http://localhost:4000/User%20Manual/User-Manual/" class="nav-list-link">User Manual</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/RunningOnOtherClusters/outline/" class="nav-list-link">Running On Other HPC Clusters</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/RunningOnOtherClusters/nersc/" class="nav-list-link">Nersc Cori</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Tristan-MP Documentation" aria-label="Search Tristan-MP Documentation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/outline/">Tristan-MP Features and Code Structure</a></li> <li class="breadcrumb-nav-list-item"><span>Code Features</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h2 id="overview"> <a href="#overview" aria-labelledby="overview" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Overview </h2> <p>Tristan-mp is implemented in Fortran 95, and is designed in a modular way, so that new relevant features can be added to the code with relative ease. In its present version, and without any alterations to the source code, Tristan-mp can simulate 2 different problems: <strong>UPDATE THIS: a shock simulation (with arbitrary plasma parameters defined in the input file) and, and a generic periodic run with two electron - ion counter-streaming beams (Weibel instability).</strong></p> <p>The code numerically solves Maxwell’s equations, and the relativistic equations of motion for the particles. It is a massively parallel code, used and tested on high-performance computational clusters, and makes use of the Message Passing Interface (<a href="https://computing.llnl.gov/tutorials/mpi/">MPI</a>) library, and the Hierarchical Data Format 5 (<a href="https://portal.hdfgroup.org/display/support">HDF5</a>) libraries for outputs. There is an ongoing effort to vectorize the code using <a href="https://www.openmp.org/">OpenMP</a>. These are third party libraries that can be easily compiled for the specific system where the code is to be used (and are usually available in most of the high-performance clusters by default). On systems where there is not a specific implementation of the MPI library to be used, one possible implementation that can be downloaded and installed is the <a href="https://www.open-mpi.org/">Open MPI library</a>. In general, we find the none-free Intel MPI library to be slightly faster in practice.</p> <p>Below you can find a general description of the code structure, and how the code is divided among the several modules. Also, you can find on this page general performance information and general rules of thumb to use when setting up a simulation. For specific information on how to setup all the keywords in the input file visit the Input Structure page. Specific instructions on how to compile the code can be found here, and specific instructions on how to run the code are available here.</p> <h2 id="general-code-structure"> <a href="#general-code-structure" aria-labelledby="general-code-structure" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> General code structure </h2> <p>For Tristan-mp, each logical module corresponds to a Fortran 95 module, which corresponds to a specific implementation file. To run the code, you need to compile it, producing the correct binary files (two different binary files can be produced, for the 2D and 3D versions of the code). A root directory for the run must then be created, and the input file must be copied into it.</p> <p><strong>UPDATE THIS</strong> The present version of the code, which is available from github (please contact the authors), consists of 20 F90 files, 1 .h file, 3 .c files, a MakefileD), and 2 sample input files. The actual number of files, however, might vary over time with different versions of the code being released. The distribution of the code among files can be roughly categorized in 7 sections: main files, main algorithms, outputs, initialization, communication, auxiliary modules, and user modules. We proceed to specify what can be found on each section.</p> <h3 id="main-files"> <a href="#main-files" aria-labelledby="main-files" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Main files </h3> <p>The main files of the code are the ones containing the calls to initialize all variables, and the main loop. These are <code class="language-plaintext highlighter-rouge">tristan.F90</code> and <code class="language-plaintext highlighter-rouge">tristanmainloop.F90</code>. These are the top level files, which control the code flow; if you are actually seeking an in-depth knowledge on how the code works, you might want to start by looking at these two files, as they represent the highest level of abstraction.</p> <p>The file <code class="language-plaintext highlighter-rouge">tristan.F90</code> is the main project file and actually just calls three functions whose names are self explanatory: <code class="language-plaintext highlighter-rouge">initialize()</code>, <code class="language-plaintext highlighter-rouge">mainloop()</code>, and <code class="language-plaintext highlighter-rouge">finalize()</code>. The <code class="language-plaintext highlighter-rouge">mainloop()</code> function is the core of Tristan-mp and is defined in <code class="language-plaintext highlighter-rouge">tristanmainloop.F90</code>; this function controls the flow of the code during the main part of the simulation. Here, functions are called to update the electromagnetic fields and to push particles around the simulation space, and to deposit charge on the grid. These functions actually implement the numerical solution to the physical equations solved in Tristan-mp and are defined in the next-subsection.</p> <h3 id="main-algorithms"> <a href="#main-algorithms" aria-labelledby="main-algorithms" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Main algorithms </h3> <p>The files and modules of this abstract section deal mostly with the numerical implementation of the physical equations solved by the code. For a particle code such as Tristan-mp, this involves solving the electromagnetic field equations (Maxwell’s equations), and using the Electric and Magnetic fields calculated on the computational mesh to advance the particle’s velocities in time via the Lorentz force equation. Additional numerical steps that must be performed include interpolating the fields from the computational mesh to the particles positions, using a first order interpolating function, and depositing the current derived from the particles’ positions and velocities back to the same mesh. Also, a digital filtering function is used to suppress non-physical short-wavelength modes that result from the finite difference techniques employed.</p> <p>These modules thus contain the core of the code, and are defined in the files <code class="language-plaintext highlighter-rouge">fields.F90</code> and <code class="language-plaintext highlighter-rouge">particles.F90</code>. The <code class="language-plaintext highlighter-rouge">file fields.F90</code> contains functions that are directly related to the electromagnetic field solvers, including the digital filtering functions. The file <code class="language-plaintext highlighter-rouge">particles.F90</code> includes all the functions that directly iterate over all the particle population, namely the velocity and position advance functions, and the functions used to deposit current on the mesh.</p> <h3 id="outputs"> <a href="#outputs" aria-labelledby="outputs" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Outputs </h3> <p>The outputs of the code are all in hdf5 files. All the output of the code is controlled and performed in the <code class="language-plaintext highlighter-rouge">output.F90</code> file. Here you can find the functions that create the output files and process the data to be dumped to the files.</p> <h3 id="initialization"> <a href="#initialization" aria-labelledby="initialization" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Initialization </h3> <p>Initialization procedures are done by initializing the MPI communication library, reading the input for the run, and then requesting that each module reads the variables that are relevant to it. This behavior is implemented and controlled mainly in the <code class="language-plaintext highlighter-rouge">initialize.F90</code> file, with corresponding implementations in each particular module. After reading the input variables, functions defined in each module are called in sequence for initialization. For example, the <code class="language-plaintext highlighter-rouge">initialize_particles()</code> function is called from <code class="language-plaintext highlighter-rouge">initialize.F90</code>; this function is actually defined and implemented in <code class="language-plaintext highlighter-rouge">particles.F90</code>. The purpose of this module is thus to centralize the initialization logic in one place, leaving the details of the actual module initialization to the modules themselves.</p> <h3 id="communication"> <a href="#communication" aria-labelledby="communication" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Communication </h3> <p>Currently, the inter-process communication functions for each module are defined in the modules themselves (e.g. functions used to transfer parts of the computational mesh between processes are defined in <code class="language-plaintext highlighter-rouge">fields.F90</code>). This behavior however, might change in the near future, depending on how the code expands, and separate fieldcomm and particlecomm modules might be created. The purpose of the communications module file communications.F90 is to define general MPI-related functions that are useful for all the communication routines defined throughout the code. At this point this function just defines functions used to time the execution of the code, and the initialization of the random seed used in the random number generator of the code. The file <code class="language-plaintext highlighter-rouge">mpidummy.F90</code> simply re-defines the MPI functions used in the code, and will only be relevant if the code is compiled in a system where no MPI library distribution is available. The use of this feature is discouraged, as it is a simple matter of installing a free distribution of the MPI libraries to have the full functionality of the code available.</p> <h3 id="auxiliary-modules"> <a href="#auxiliary-modules" aria-labelledby="auxiliary-modules" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Auxiliary modules </h3> <p><strong>OUT OF DATE, UPDATE</strong></p> <p>The auxiliary module files are the ones handling the auxiliary features of the code, some essential, others not. These include the files <code class="language-plaintext highlighter-rouge">aux.F90</code>, <code class="language-plaintext highlighter-rouge">domain.F90</code>, <code class="language-plaintext highlighter-rouge">restart.F90</code>, <code class="language-plaintext highlighter-rouge">inputparser.F90</code>, <code class="language-plaintext highlighter-rouge">fparser.F90</code>, <code class="language-plaintext highlighter-rouge">system.F90</code>, <code class="language-plaintext highlighter-rouge">selectprt.F90</code>, and <code class="language-plaintext highlighter-rouge">splittestpart.F90</code>. These two last files define independent programs used for the particle track diagnostics of the code. In the current version of the code, the file <code class="language-plaintext highlighter-rouge">aux.F90</code> just defines the random number generator. The file <code class="language-plaintext highlighter-rouge">domain.F90</code> defines functions that allow the computational domain to grow in time, which is used for efficiency in the shock simulations. The file <code class="language-plaintext highlighter-rouge">inputparser.F90</code> links to <code class="language-plaintext highlighter-rouge">par.c</code> and <code class="language-plaintext highlighter-rouge">par.h</code> which are actually responsible for parsing the input file. The fparser.F90 module is generica mathematical function parser, that allows the user to specify arbitrary functions in the input file (which can then be used to setup the simulation). Finally, the <code class="language-plaintext highlighter-rouge">restart.F90</code> file defines functions that allow the complete state of a simulation to be stored on a disk at a given point and restarted later, and the file system.F90 defines system specific auxiliary functions.</p> <h3 id="user-module"> <a href="#user-module" aria-labelledby="user-module" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> User module </h3> <p>The user file, <code class="language-plaintext highlighter-rouge">user_*.F90</code>, such as <code class="language-plaintext highlighter-rouge">user_shock.F90</code> or <code class="language-plaintext highlighter-rouge">user_weibel.F90</code>, is used for readily expanding the behavior of the code without having to alter any of the code-flow logic. The user defines routines for loading and injecting particles here, as well special boundary conditions on fields and particles (e.g. reflecting walls). The purpose of the user module is to make the expansion and generalization of the code more accessible, in particular when this does not involve modifying the underlying numerical methods used to solve the physical equations. Expansion of the code by adding other modules and modifying the core structure of the code might also be attempted, but will probably require more time, and a more complete understanding of the underlying structure of the entire code.</p> <hr> <footer> <p class="text-small text-grey-dk-000 mb-0">Website compiled by <a href="https://www.linkedin.com/in/patrick-crumley/">Patrick Crumley</a>. Please feel free to contribute on <a href="https://github.com/pcrumley/ml_stat_resources">GitHub.</a></p> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
