<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Running Tristan-MP - Tristan-MP Documentation</title> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="http://localhost:4000/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="http://localhost:4000/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="http://localhost:4000/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>Running Tristan-MP | Tristan-MP Documentation</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Running Tristan-MP" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A wiki of Machine learning and Statistics resources useful for self-learning." /> <meta property="og:description" content="A wiki of Machine learning and Statistics resources useful for self-learning." /> <link rel="canonical" href="http://localhost:4000/GettingStarted/Running-your-first-Tristan-MP-simulation/" /> <meta property="og:url" content="http://localhost:4000/GettingStarted/Running-your-first-Tristan-MP-simulation/" /> <meta property="og:site_name" content="Tristan-MP Documentation" /> <script type="application/ld+json"> {"headline":"Running Tristan-MP","description":"A wiki of Machine learning and Statistics resources useful for self-learning.","@type":"WebPage","url":"http://localhost:4000/GettingStarted/Running-your-first-Tristan-MP-simulation/","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> Tristan-MP Documentation </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/README/" class="nav-list-link">Home</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/GettingStarted/outline/" class="nav-list-link">Getting Started</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/GettingStarted/Logging-in-to-perseus/" class="nav-list-link">Logging into Perseus</a></li><li class="nav-list-item "><a href="http://localhost:4000/GettingStarted/Downloading-and-Compiling-Tristan/" class="nav-list-link">Compiling Tristan-MP</a></li><li class="nav-list-item active"><a href="http://localhost:4000/GettingStarted/Running-your-first-Tristan-MP-simulation/" class="nav-list-link active">Running Tristan-MP</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/AnalyzingSims/outline/" class="nav-list-link">Analyzing Simulations</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/AnalyzingSims/Logging-in-to-tigressdata2/" class="nav-list-link">Logging into TigressData2</a></li><li class="nav-list-item "><a href="http://localhost:4000/AnalyzingSims/Writing-your-own-python-scripts/" class="nav-list-link">Writing a python analysis script</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/Example%20Simulations/outline/" class="nav-list-link">Example Simulations</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/Example%20Simulations/Sample-Weibel-run/" class="nav-list-link">Weibel Simulation</a></li><li class="nav-list-item "><a href="http://localhost:4000/Example%20Simulations/Sample-shock-run/" class="nav-list-link">Shock Simulation</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/outline/" class="nav-list-link">Tristan-MP Features and Code Structure</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/Code-Features/" class="nav-list-link">Code Features</a></li><li class="nav-list-item "><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/Input-Files/" class="nav-list-link">Input Files</a></li><li class="nav-list-item "><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/User-Files/" class="nav-list-link">User Files</a></li><li class="nav-list-item "><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/Compilation/" class="nav-list-link">Compiling Tristan</a></li><li class="nav-list-item "><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/Running/" class="nav-list-link">Running Tristan</a></li></ul></li><li class="nav-list-item"><a href="http://localhost:4000/User%20Manual/User-Manual/" class="nav-list-link">User Manual</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/RunningOnOtherClusters/outline/" class="nav-list-link">Running On Other HPC Clusters</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/RunningOnOtherClusters/nersc/" class="nav-list-link">Nersc Cori</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Tristan-MP Documentation" aria-label="Search Tristan-MP Documentation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/GettingStarted/outline/">Getting Started</a></li> <li class="breadcrumb-nav-list-item"><span>Running Tristan-MP</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <p><em>This section assumes you have already <a href="/GettingStarted/Logging-in-to-perseus/">logged into perseus</a> and followed the instructions in <a href="/GettingStarted/Downloading-and-Compiling-Tristan/">Downloading and Compiling Tristan-mp</a></em></p> <h2 id="getting-ready"> <a href="#getting-ready" aria-labelledby="getting-ready" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Getting ready </h2> <p>Now, let’s run your first shock simulation!</p> <p><code class="language-plaintext highlighter-rouge">cd</code> back to your <code class="language-plaintext highlighter-rouge">tigress</code> folder</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/tig
</code></pre></div></div> <p>Generally, you’ll want to run each simulation in its own directory. Let’s make a directory for your first run, and <code class="language-plaintext highlighter-rouge">cd</code> into it</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>firstrun
<span class="nb">cd </span>firstrun
</code></pre></div></div> <p>Now, we need to add our input file and executable to the <code class="language-plaintext highlighter-rouge">firstrun</code> folder.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> ~/tig/tristan-mp-pu/exec/tristan-mp2d ./
<span class="nb">cp</span> ~/tig/tristan-mp-pu/user_NAME/input.myshock ./
</code></pre></div></div> <p>Check the contents of <code class="language-plaintext highlighter-rouge">firstrun</code> folder by typing <code class="language-plaintext highlighter-rouge">ls</code>. You should be able to confirm files were copied.</p> <h2 id="editing-the-input-file"> <a href="#editing-the-input-file" aria-labelledby="editing-the-input-file" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Editing the Input file </h2> <p>The parameters of the shock run e.g. size of the box, number of particles, etc. is set using a input file. The input file has different sections demarcated by a <code class="language-plaintext highlighter-rouge">&lt;SECTION NAME&gt;</code> Let’s go over each section of the <code class="language-plaintext highlighter-rouge">input.myshock</code> file. Follow along by typing <code class="language-plaintext highlighter-rouge">nano input.shock</code>.</p> <h3 id="node-configuration"> <a href="#node-configuration" aria-labelledby="node-configuration" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Node configuration </h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#
#	Tristan-mp input file
#
#

&lt;node_configuration&gt;

sizex	= 16    # number of cpus in x direction
sizey 	= 1	# number of cpus in the y direction
</code></pre></div></div> <p>This section defines the number of MPI jobs AKA cores/CPUs used in each direction. In general, it’s best practice to completely fill nodes on your system. The total number of cores required is <code class="language-plaintext highlighter-rouge">sizex*sizey</code>. On <code class="language-plaintext highlighter-rouge">perseus</code> each node has 28 cores. Change <code class="language-plaintext highlighter-rouge">sizex</code> to 4 and <code class="language-plaintext highlighter-rouge">sizey</code> to 7. Later, when we submit the job we’ll need to tell the scheduler we’ll take 28 cores.</p> <h3 id="time"> <a href="#time" aria-labelledby="time" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Time </h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;time&gt;
last 	= 600000      # last timestep
c	= .45	      # velocity of light in comp. units
                      # this defines the timestep
timespan = 60000000   # time, in seconds, available to run the problem,
                      # to not save restart before the end
</code></pre></div></div> <p>In general you shouldn’t need to change this section. <code class="language-plaintext highlighter-rouge">last</code> is the timestep where the program will terminate. <code class="language-plaintext highlighter-rouge">c</code> is the speed of light in the grid. In PIC simulations <code class="language-plaintext highlighter-rouge">c</code> is traditionally set to 0.45 which means a photon will propagate 0.45 cells in one time step. This value guarantees that the Courant condition is satisfied. <strong>I’m not sure that <code class="language-plaintext highlighter-rouge">timespan</code> does</strong>. Since we’re just running a short test run, let’s set last to 15000.</p> <h3 id="grid"> <a href="#grid" aria-labelledby="grid" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Grid </h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;grid&gt;

mx0 	= 10000         # number of actual grid points in the x direction
my0 	= 128           # number of actual grid points in the y direction
mz0 	= 1 	        # ... (ignored for 2D simulations)
</code></pre></div></div> <p>The part of the input file that sets the size of the simulation domain in cells. Since we’re running the simulation for 15000 time steps, lets set mx0 to <code class="language-plaintext highlighter-rouge">10000</code>. In production runs, you should take advantage of the expanding box, but for now, let’s keep things simple. Also <code class="language-plaintext highlighter-rouge">sizey</code> should be a factor of <code class="language-plaintext highlighter-rouge">my0</code>. Since we chose <code class="language-plaintext highlighter-rouge">sizey=7</code> set <code class="language-plaintext highlighter-rouge">my0=133</code></p> <h3 id="load-balancing"> <a href="#load-balancing" aria-labelledby="load-balancing" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Load balancing </h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;dynamic_grid&gt;

dynmx           = 1      # 1 for dynamic allocation of mx
dynmxstart      = 1      # starting timestep
dynmxinterval   = 200    # update interval
mxmin           = 7      # minimum mx/cpu

dynmy           = 0
dynmystart      = 1
dynmyinterval   = 200
mymin           = 7
</code></pre></div></div> <p>This part of the input file are related to load balancing the code. In general, you want a roughly equal number of particles on each code, so each core is working as hard as all the others. The simulation has to wait until all cores are done with the current lap before it can start the next lap. Initially each core takes a equal sized part of the grid, but if there are strong density fluctuations, some parts of the grid become more expensive than others. If you choose, tristan-MP can try to dynamically re-allocate the grid. The parameters <code class="language-plaintext highlighter-rouge">dynmx</code> and <code class="language-plaintext highlighter-rouge">dynmy</code> are set to 1, tristan will reallocate in the <code class="language-plaintext highlighter-rouge">x</code> and <code class="language-plaintext highlighter-rouge">y</code> direction respectively. <code class="language-plaintext highlighter-rouge">dynm*start</code> Is the starting lap to reallocate the grid, this should almost always be set to 1. <code class="language-plaintext highlighter-rouge">dynm*interval</code> chooses how many laps between load balancing. <code class="language-plaintext highlighter-rouge">m*min</code> is the minimum size the dynamic decomposition will allow. If you make it less than 7 you’ll spend too much time calculating ghost zones. Don’t change anything here.</p> <h3 id="field-solver"> <a href="#field-solver" aria-labelledby="field-solver" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Field solver </h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;algorithm&gt;

highorder	= 0	# 0 -- 2nd order FDTD field integration; 1 -- 4th order;
                        # don't use 1 for non-relativistic flows

Corr		= 1.0	# correction for the speed of light
ntimes		= 32    # number of passes for smoothing filter (current)
</code></pre></div></div> <p>These parts of the input change parts of the field solver. Setting <code class="language-plaintext highlighter-rouge">highorder</code> to 1 if particles are moving relativistic flows is useful because it helps with numerical Cherenkov. <code class="language-plaintext highlighter-rouge">Corr</code> is a special parameter, it is basically a way to makes E&amp;M fields to travel slightly faster than the speed of light. For relativistic flows, you can set <code class="language-plaintext highlighter-rouge">Corr=1.025</code>. <code class="language-plaintext highlighter-rouge">ntimes</code> is the number of times to apply a 2D Gaussian smoothing filter to the current before depositing the current on the grid. It helps with high frequency fluctuations which can be caused by noise, numerical Cherenkov, or electrostatic fluctions from too low <code class="language-plaintext highlighter-rouge">ppc0</code> and/or resolution. Set <code class="language-plaintext highlighter-rouge">ntimes</code> to 4.</p> <h3 id="restart"> <a href="#restart" aria-labelledby="restart" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Restart </h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;restart&gt;

irestart = 0                # 1 to restart the simulation from saved
                            # restart/*.d files.
intrestart = 10000          # How often to save restart files.
                            # They overwrite previous *d files.
laprestart = 0	            # if different from 0, restart from a
                            # named restart file,
                            # saved at timestep laprestart
namedrestartint = 80000000  # interval for saving named restart files,
                            # like restart.lap01234.d
</code></pre></div></div> <p>This part of the file is for restarting simulations after they have ended. If you want to restart a simulation, you need to resubmit the job from the same directory as before but with <code class="language-plaintext highlighter-rouge">irestart</code> equal to 1. For now, let’s not do anything.</p> <h3 id="output"> <a href="#output" aria-labelledby="output" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Output </h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;output&gt;

intervaal  = 500    # plot interval
pltstart   = 0      # starting iteration for first plot

istep      = 2	    # downsampling factor for grid output
stride	   = 20	    # particle stride for particle output

###############################################################
writetestlec    = 0         # write test electrons for tracking
dlaplec         = 90        # interval
teststartlec    = 1000000   # starting lap
testendlec      = 6000000

writetestion    = 0         # write test ions for tracking
dlapion         = 600       # interval
teststartion    = 1000000   # starting lap
testendion      = 6000000
###############################################################
</code></pre></div></div> <p>Here we can change how often we output files. <code class="language-plaintext highlighter-rouge">interval</code> is how often the data will be saved. <code class="language-plaintext highlighter-rouge">ptlstart</code> is the first time to start saving. When saving fields data, it is downsampled by a factor <code class="language-plaintext highlighter-rouge">istep</code> in all directions. Similarly the particle arrays are downsampled by a factor <code class="language-plaintext highlighter-rouge">stride</code>. The stuff inside of the <code class="language-plaintext highlighter-rouge">#</code> is related to particle tracking, don’t worry about it for now.</p> <h3 id="boundaries"> <a href="#boundaries" aria-labelledby="boundaries" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Boundaries </h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;boundaries&gt;

periodicx	= 0	# periodic boundaries in the x direction?
periodicy	= 1	# periodic boundaries in the y direction?
periodicz	= 1     # periodic boundaries in the z direction?
</code></pre></div></div> <p>Pretty self-explanatory. Change nothing.</p> <h3 id="domain"> <a href="#domain" aria-labelledby="domain" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Domain </h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;domain&gt;

enlarge		= 1   # if 1, enlarge box in the x direction if
                      # injector is close to right wall
</code></pre></div></div> <p>Setting <code class="language-plaintext highlighter-rouge">enlarge</code> to 1 makes the box expand to the right with time. For now, let’s set it to 0.</p> <h3 id="b-field-setup"> <a href="#b-field-setup" aria-labelledby="b-field-setup" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> B-field setup </h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;fields&gt;

btheta	= 70	# bfield angle bphi=0 -&gt; bz,
                # bphi=90 in x-y plane, btheta=0-&gt; parallel
bphi	= 90 	#
</code></pre></div></div> <p>We’re going to run an unmagnetized shock so <code class="language-plaintext highlighter-rouge">btheta</code> and <code class="language-plaintext highlighter-rouge">bphi</code> are meaningless.</p> <h3 id="particles"> <a href="#particles" aria-labelledby="particles" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Particles </h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;particles&gt;

sigma	= 0.1    # magnetization number (omega_ce/omega_pe)^2,
                 # including gamma0 for inertia
maxptl0 = 1e9    # max number of particles in the simulation
ppc0 	= 16     # number of particles per cell


delgam 	= 1.e-4	 # delta gamma for ions
                 # delgam = k T_i / m_i c^2,
                 # T_i is ion temperature
me	= 1.	 # electron mass
mi	= 100. 	 # ion mass
                 # (actually mass to charge ratio)

gamma0	= 0.1	 # flow drift gamma. If &lt; 1,
                 # interpreted as v/c.
		 # the drift of background plasma
                 # in the negative x direction
c_omp	= 10	 # electron skin depth in cells
</code></pre></div></div> <p>Here we edit some particle &amp; field quantities. <code class="language-plaintext highlighter-rouge">sigma</code> is the magnetization and it’s definition shows up in <code class="language-plaintext highlighter-rouge">binit</code> in the user file. Let’s run an unmagnetized shock; set <code class="language-plaintext highlighter-rouge">sigma</code> to zero. <code class="language-plaintext highlighter-rouge">maxptl0</code> is the total number of particles the simulation can handle, for very long runs, you may need to increase it. Keep it at 1 billion for now. <code class="language-plaintext highlighter-rouge">ppc0</code> is the total number of particles in each initialized cell. <code class="language-plaintext highlighter-rouge">ppc0=16</code> means there are 8 electrons and 8 ions. <code class="language-plaintext highlighter-rouge">delgam</code> is the temperature of the ions, and the mass of the ions is controlled via <code class="language-plaintext highlighter-rouge">me</code> and <code class="language-plaintext highlighter-rouge">mi</code>. In theory one could change both of these quantities, but you should generally just change <code class="language-plaintext highlighter-rouge">mi</code>. Let’s run a pair shock, so set <code class="language-plaintext highlighter-rouge">mi</code> to 1. <code class="language-plaintext highlighter-rouge">gamma0</code> is the flow speed in the leftward direction. Set <code class="language-plaintext highlighter-rouge">gamma0</code> to 0.5, i.e., half the speed of light.</p> <h3 id="problem"> <a href="#problem" aria-labelledby="problem" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Problem </h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;problem&gt;

distr_dim = 3           # Dimensionality of particle distirbution;
                        # 2 means Tx=Ty=T, Tz=0; 3 means Tx=Ty=Tz=T
	                # if distr_dim = 2 and sigma is non-zero,
                        # code will reset it to 3.


temperature_ratio = 1   # T_e/T_i

external_fields = 0     # if nonzero, add external nonevolving fields
                        # to mover; defined in user file
sigma_ext = 0.          # strength of external magnetization,
                        # (omega_ce/omega_pe)^2,
                        # including gamma0

user_part_bcs=1         # call particle_bc_user routine from user file,
                        # specify particle bcs like walls
wall = 1                # left wall on?
wallgam = 0             # gamma of the moving reflecting wall on the left.
                        # If &lt; 1, read as v/c. Set to 0 or 1 to
                        # not move the wall.
left_wall_speedup = 1.  # remove downstream a little faster;
                        # used for moving left wall, 1 is no speedup.

betainj = 0.2           # how fast injector is receding
betainj_interval = 2000 # how often to check file adjust_params where betainj
                        # can be modified as the code runs
rightclean = 1          # jumping right injector, on average moving at betainj
rightwall = 1           # reflecting particle wall at injector
</code></pre></div></div> <p>These are the parts of the input file that are defined in the user file. I don’t want to explain every parameter, their definitions can be deduced by reading the source code of your user file. Let’s just focus on the ones you will change. <code class="language-plaintext highlighter-rouge">left_wall_speedup</code> periodically removes parts of the downstream of the shock. Set to zero. <code class="language-plaintext highlighter-rouge">beta_inj</code> is the average speed of the expanding box. I am not sure if it matters when <code class="language-plaintext highlighter-rouge">enlarge</code> is set to zero, but set to zero anyway. <code class="language-plaintext highlighter-rouge">righclean</code> turns on the jumping injector. The injectors moves faster than <code class="language-plaintext highlighter-rouge">beta_inj</code> on every timestep to the right but jumps backwards periodically to ensure that the average speed is <code class="language-plaintext highlighter-rouge">beta_inj</code>. Set to zero. <code class="language-plaintext highlighter-rouge">rightwall</code> puts a wall on the right side of the box. For cold flows it doesn’t matter. Set to zero.</p> <p>You are now done editing the parameter file. Close and save your <code class="language-plaintext highlighter-rouge">nano</code> session using <code class="language-plaintext highlighter-rouge">ctrl+x</code> and typing <code class="language-plaintext highlighter-rouge">y</code> and <code class="language-plaintext highlighter-rouge">enter</code>.</p> <h2 id="submitting-jobs"> <a href="#submitting-jobs" aria-labelledby="submitting-jobs" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Submitting jobs </h2> <p>To run a big job on a cluster, you cannot simply set it to run. Instead you send your job to a scheduler using a submit script. The scheduler then adds your job to a queue. The scheduler, not you, starts running your code. The specifics of the scheduler depends on the cluster, and you should always read the recommended submit file for the machine you are using. Perseus uses <a href="https://researchcomputing.princeton.edu/education/online-tutorials/getting-started/introducing-slurm">SLURM</a>.</p> <p>Slurm needs a <code class="language-plaintext highlighter-rouge">submit</code> shell script. The script tells slurm how many resources you need and what job you want run. We’ll create a <code class="language-plaintext highlighter-rouge">submit</code> file now. By opening a new empty text file called <code class="language-plaintext highlighter-rouge">submit</code> in nano</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nano submit
</code></pre></div></div> <p>The first line of your submit file just tells the schedule you want to interpret it using bash. Add this to your file</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
</code></pre></div></div> <p>Next, we need to tell slurm how many resources we will need. In the input file we set <code class="language-plaintext highlighter-rouge">sizex=4</code>, <code class="language-plaintext highlighter-rouge">sizey=7</code>, meaning we will start <code class="language-plaintext highlighter-rouge">4x7=28</code> MPI jobs or as slurm calls them ‘tasks’. Each cpu will have its own task, the default for slurm. You request tasks with the <code class="language-plaintext highlighter-rouge">--ntasks=</code> flag (or <code class="language-plaintext highlighter-rouge">-n</code>). Add a line to your submit script so slurm knows you need 28 tasks.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#SBATCH --ntasks=28</span>
</code></pre></div></div> <p>It is nice to also specify the number of nodes, although technically not always 100% necessary. Each node has 28 cores, and you most likely will want to fully fill nodes. You request nodes with the <code class="language-plaintext highlighter-rouge">--nodes=</code> flag (or <code class="language-plaintext highlighter-rouge">-N</code>). Add a line to make slurm ask for 1 node</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#SBATCH --nodes=1</span>
</code></pre></div></div> <p>You should add some lines that makes slurm email you when your job starts and stops. Add the following lines, and change it to your personal email. Slurm may start are stop your job at unexpected times. If it is important to know when your job starts, you may want to choose an email you that will send you notifications.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#SBATCH --mail-type=begin</span>
<span class="c">#SBATCH --mail-type=end</span>
<span class="c">#SBATCH --mail-user=YOUR_EMAIL@THEINTER.NET</span>
</code></pre></div></div> <p>Finally we need to tell slurm how long you want your job to run for using the <code class="language-plaintext highlighter-rouge">--time</code> flag (or <code class="language-plaintext highlighter-rouge">-t</code>). If your job ends before the time is up or crashes, slurm deallocates the resources. Let’s run for 1 hour. Acceptable time formats include ‘minutes’, ‘minutes:seconds’, ‘hours:minutes:seconds’, ‘days-hours’, ‘days-hours:minutes’ and ‘days-hours:minutes:seconds’. The maximum time you can run a job on perseus is 2 days.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#SBATCH --time=01:00:00</span>
</code></pre></div></div> <p>Now we have given slurm all of our options, and we are ready for it to run the code. In general, you’ll need to make sure that your code will run after you have loaded the modules that you compiled tristan-mp with to run (i.e., intel, intel-mpi and hdf5). Add the following lines to your submit script.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module load intel
module load intel-mpi
module load hdf5/intel-16.0/intel-mpi/1.8.16
</code></pre></div></div> <p>Now we are ready to run tristan in our <code class="language-plaintext highlighter-rouge">submit</code> script. Add the line</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>srun ./tristan-mp2d <span class="nt">-i</span> input.myshock <span class="o">&gt;</span> out
</code></pre></div></div> <p>And submit the job by running</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sbatch submit
</code></pre></div></div> <p>Slurm will respond with <code class="language-plaintext highlighter-rouge">Submitted batch job &lt;XXXXXXX&gt;</code>, where <strong>IGNORE REMAINING PART</strong></p> <h2 id="checking-in-on-running-jobs"> <a href="#checking-in-on-running-jobs" aria-labelledby="checking-in-on-running-jobs" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Checking in on running jobs </h2> <p>nano -w submit (enables you to modify the submit file)</p> <p>Make sure that <code class="language-plaintext highlighter-rouge">-i input.shock</code> is included in the last line of the <code class="language-plaintext highlighter-rouge">submit</code> file, right before the ` &gt; out`.</p> <p>After completing the parameter settings, type:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sbatch submit
</code></pre></div></div> <p>Type <code class="language-plaintext highlighter-rouge">showq |grep netID</code> to view the progress.</p> <p>If you want to cancel a job, find the <code class="language-plaintext highlighter-rouge">slurm - xxxxx</code> file in the run directory and type:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scancel xxxxx
</code></pre></div></div> <hr> <footer> <p class="text-small text-grey-dk-000 mb-0">Website compiled by <a href="https://www.linkedin.com/in/patrick-crumley/">Patrick Crumley</a>. Please feel free to contribute on <a href="https://github.com/pcrumley/ml_stat_resources">GitHub.</a></p> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
