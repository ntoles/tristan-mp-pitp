<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Compiling Tristan - Tristan-MP Documentation</title> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="http://localhost:4000/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="http://localhost:4000/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="http://localhost:4000/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>Compiling Tristan | Tristan-MP Documentation</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Compiling Tristan" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A wiki of Machine learning and Statistics resources useful for self-learning." /> <meta property="og:description" content="A wiki of Machine learning and Statistics resources useful for self-learning." /> <link rel="canonical" href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/Compilation/" /> <meta property="og:url" content="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/Compilation/" /> <meta property="og:site_name" content="Tristan-MP Documentation" /> <script type="application/ld+json"> {"headline":"Compiling Tristan","description":"A wiki of Machine learning and Statistics resources useful for self-learning.","@type":"WebPage","url":"http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/Compilation/","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> Tristan-MP Documentation </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/README/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/GettingStarted/outline/" class="nav-list-link">Getting Started</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/GettingStarted/Logging-in-to-perseus/" class="nav-list-link">Logging into Perseus</a></li><li class="nav-list-item "><a href="http://localhost:4000/GettingStarted/Downloading-and-Compiling-Tristan/" class="nav-list-link">Compiling Tristan-MP</a></li><li class="nav-list-item "><a href="http://localhost:4000/GettingStarted/Running-your-first-Tristan-MP-simulation/" class="nav-list-link">Running Tristan-MP</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/AnalyzingSims/outline/" class="nav-list-link">Analyzing Simulations</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/AnalyzingSims/Logging-in-to-tigressdata2/" class="nav-list-link">Logging into TigressData2</a></li><li class="nav-list-item "><a href="http://localhost:4000/AnalyzingSims/Writing-your-own-python-scripts/" class="nav-list-link">Writing a python analysis script</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/Example%20Simulations/outline/" class="nav-list-link">Example Simulations</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/Example%20Simulations/Sample-Weibel-run/" class="nav-list-link">Weibel Simulation</a></li><li class="nav-list-item "><a href="http://localhost:4000/Example%20Simulations/Sample-shock-run/" class="nav-list-link">Shock Simulation</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/outline/" class="nav-list-link">Tristan-MP Features and Code Structure</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/Code-Features/" class="nav-list-link">Code Features</a></li><li class="nav-list-item "><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/Input-Files/" class="nav-list-link">Input Files</a></li><li class="nav-list-item "><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/User-Files/" class="nav-list-link">User Files</a></li><li class="nav-list-item active"><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/Compilation/" class="nav-list-link active">Compiling Tristan</a></li><li class="nav-list-item "><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/Running/" class="nav-list-link">Running Tristan</a></li></ul></li><li class="nav-list-item"><a href="http://localhost:4000/User%20Manual/User-Manual/" class="nav-list-link">User Manual</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/RunningOnOtherClusters/outline/" class="nav-list-link">Running On Other HPC Clusters</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/RunningOnOtherClusters/nersc/" class="nav-list-link">Nersc Cori</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Tristan-MP Documentation" aria-label="Search Tristan-MP Documentation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/outline/">Tristan-MP Features and Code Structure</a></li> <li class="breadcrumb-nav-list-item"><span>Compiling Tristan</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <p><strong>THIS SECTION IS OLD AND DEPRECATED. PLEASE SEE <a href="/GettingStarted/Downloading-and-Compiling-Tristan.md">THIS</a> INSTEAD</strong></p> <h2 id="compilation"> <a href="#compilation" aria-labelledby="compilation" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Compilation </h2> <p>There are three different steps involved in the compilation of Tristan-mp. The first two steps are the compilation of the MPI and HDF5 libraries if they are not already available on the system you are going to run. For most cases, there will be a preferred system-specific MPI implementation for most of the high-performance computational clusters where you should be running Tristan-mp. You should always use this MPI library implementation; just be aware that Fortran bindings to the library are necessary (they usually are included by default). Regarding the HDF5 libraries, when available they still might not have the required fortran bindings and/or parallel output bindings, which are a requirement of the code. As such you might have to compile your own version of the HDF5 library. The following two sections show you how to do this, but they are not intended as a substitute for the documentation of the libraries, and assume a basic knowledge of Unix systems. For more information read the documentation available with the MPI and HDF5 library distributions.</p> <h2 id="mpi-library"> <a href="#mpi-library" aria-labelledby="mpi-library" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> MPI library </h2> <p>The preferred MPI distribution to use (other than any system specific distribution available), is the Open MPI library available for download <a href="https://www.open-mpi.org/">here</a>. After downloading the source files for the library (as a .tar.gz file or similar), you will need to copy this to the remote system where it is to be installed. To do that you will usually use a command such as scp, as in <code class="language-plaintext highlighter-rouge">scp downloaded-file username@remotesystem:</code> . You might be asked for your password to the remote system, and this should copy the file to your home directory there. Next step is to login into the system (usually via ssh).</p> <p>You will now have to untar / unzip the .tar.gz file, using a command such as tar -xzf filename or similar, and this will create the installation directory. Change directories to the installation directory.</p> <p>Now you will have to figure out the appropriate configuration options for the library. You will do this by typing <code class="language-plaintext highlighter-rouge">./configure --help</code>. At the very least, you will have to change the final installation directory, and make sure that Fortran bindings are included in the distribution (they usually are by default). Also, you will have to configure the correct C and Fortran compilers for the library to use (such as gcc and gfortran, or icc and ifort). These should be the compilers that are recommended for the system you are using.</p> <p>After figuring out the configuration options, you will just have to run: ./configure (passing in the options), make and make install. This will produce the final library installation diretory with the .dylib (and / or .a files), and the executable files mpicc and mpif90, among others. These two will be necessary for the next step.</p> <h2 id="hdf5-library"> <a href="#hdf5-library" aria-labelledby="hdf5-library" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> HDF5 library </h2> <p>Installing the HDF5 libraries is similar to the process described above for the MPI libraries. You first download the source files for the library <a href="https://portal.hdfgroup.org/display/support">here</a>. After that, you copy to the remote system, and untar / unzip as described above.</p> <p>Once logged in the system, the first step is to figure out if the mpicc and mpif90 compiler wrappers are available in the system. When you type <code class="language-plaintext highlighter-rouge">which mpicc</code> and <code class="language-plaintext highlighter-rouge">which mpif90</code>, you should see the complete path to these executables; the path should correspond to the appropriate MPI library that you will be using (either a system one, or the one you installed). For this to work you might have to add the path for mpicc and mpif90 to your path variable, if you did not do so already. You do this by typing</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>setenv PATH ${PATH}:path-to-the-mpi-distribution-bin-folder
</code></pre></div></div> <p>(for csh, tcsh, or similar), or</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export PATH=${PATH}:path-to-the-mpi-distribution-bin-folder
</code></pre></div></div> <p>(for sh, bash, ksh, or similar).</p> <p>Next, you will have to determine the correct options to pass to <code class="language-plaintext highlighter-rouge">./configure</code>, as in the installation for the MPI library above. At the very least, you will configure a correct destination folder (a sub-directory on your home folder), and turn on Fortran bindings and parallel bindings. Also, the compilers to use will be mpicc and mpif90 for C and Fortran, respectively.</p> <p>After this, you will run <code class="language-plaintext highlighter-rouge">./configure</code> (passing in the options), <code class="language-plaintext highlighter-rouge">make</code> and <code class="language-plaintext highlighter-rouge">make install</code>. This will produce the final library installation directory with the .dylib (and / or .a files), and the executable file h5pfc, among others. This file will be necessary for the next step.</p> <p>Example:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./configure <span class="nt">--help</span>
</code></pre></div></div> <p>this lists the options</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">CC</span><span class="o">=</span>mpicc
<span class="nb">export </span><span class="nv">CXX</span><span class="o">=</span>mpicc
<span class="nb">export </span><span class="nv">FC</span><span class="o">=</span>mpif90
configure <span class="nt">--prefix</span><span class="o">=</span>/home/username/bin/hdf5 <span class="nt">--enable-parallel</span> <span class="nt">--enable-fortran</span>
make <span class="nb">install</span>
</code></pre></div></div> <h2 id="tristan-mp-compilation"> <a href="#tristan-mp-compilation" aria-labelledby="tristan-mp-compilation" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tristan-mp compilation </h2> <p>After downloading the code source, and copying the source to your cluster, you can compile the code to produce binaries for 2D or 3D version.</p> <p>As a first step, you have to make sure that the h5pfc tool is available in the HDF5 library distribution you are using. This file should be in the bin directory of the library distribution. If it is not, you will have to recompile the HDF5 libraries following the instructions above. Once you know where this executable is located, add it to your path, so that it is accessible by the Tristan-mp Makefile (and Makefile3D). You usually do that by executing</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>setenv PATH ${PATH}:path-to-the-library-bin-folder
</code></pre></div></div> <p>(in c type shells - csh, tcsh and such), or</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export PATH=${PATH}:path-to-the-library-bin-folder
</code></pre></div></div> <p>(in sh, bash, ksh, or other similar shells). It is a good idea to add these commands to your <code class="language-plaintext highlighter-rouge">.bashrc</code> or <code class="language-plaintext highlighter-rouge">.cshrc</code> file.</p> <p>If when you type which h5pfc you get the path to the binary file, you are set to go. Just change directory to the Tristan-mp distribution’s source folder and type <code class="language-plaintext highlighter-rouge">make</code> to get the 2D version of the code).</p> <p><strong>THIS IS IMPORTANT!</strong></p> <p>The code is organized in a modular way, so that in most cases the user does not need to edit any of the source files except for the <code class="language-plaintext highlighter-rouge">user_*.F90</code> file. Two examples, <code class="language-plaintext highlighter-rouge">user_weibel.F90</code> and <code class="language-plaintext highlighter-rouge">user_shock.F90</code> are provided.</p> <p>Corresponding input files are also in the user directory. The choice of which user file will be compiled is made by modifying the USER variable in the source/Makefile or Makefile3D.</p> <p>The standard workflow for a new problem definition is to copy one of the example <code class="language-plaintext highlighter-rouge">user_*</code> files to a new <code class="language-plaintext highlighter-rouge">user_myrun.F90</code> file (where <code class="language-plaintext highlighter-rouge">myrun</code> is something descriptive) and editing this user file. There are routines for initializing particles, injecting particles during the run, and special particle and field boundary conditions which are listed in the user_*.F90 file. When ready, there is no reason to edit the Makefile, instead run</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make clean
make <span class="nv">USER_FILE</span><span class="o">=</span>user_myrun
</code></pre></div></div> <p>and set USER=user_myrun, or whatever is the name of your user file omitting .F90</p> <p>IT IS VERY EASY TO FORGET THE USER_FILE flag, and the code will compile the old user module. Not very useful. The name of the user file is printed in the beginning of the out file when the code runs. So, check that if the result does not make sense.</p> <p>Note that you might also have to alter some of the pre-processor and/or processor options under the keyword CUSTOM in the Makefile (Makefile and Makefile3D), which reads something like <code class="language-plaintext highlighter-rouge">CUSTOM= -DMPI -DHDF5 -DserIO -fpp -DtwoD</code>. This is just defining keywords to be passed to the pre-processor, and since the way to do this is compiler dependent you might have to change it. The code in the current version of the repository will compile by default using gcc and gfortran.</p> <p><em>Some notes:</em> When working with both 2D and 3D version, make sure to run “make clean” or “make -f Makefile3D clean” before switching to compilation in different number of dimensions. Some of the libraries have the same names, but are compiled with different flags.</p> <p>Not doing this will in general lead to a compilation failure.</p> <hr> <footer> <p class="text-small text-grey-dk-000 mb-0">Website compiled by <a href="https://www.linkedin.com/in/patrick-crumley/">Patrick Crumley</a>. Please feel free to contribute on <a href="https://github.com/pcrumley/ml_stat_resources">GitHub.</a></p> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
