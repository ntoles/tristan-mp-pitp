<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>User Files - Tristan-MP Documentation</title> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="http://localhost:4000/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="http://localhost:4000/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="http://localhost:4000/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>User Files | Tristan-MP Documentation</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="User Files" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A wiki of Machine learning and Statistics resources useful for self-learning." /> <meta property="og:description" content="A wiki of Machine learning and Statistics resources useful for self-learning." /> <link rel="canonical" href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/User-Files/" /> <meta property="og:url" content="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/User-Files/" /> <meta property="og:site_name" content="Tristan-MP Documentation" /> <script type="application/ld+json"> {"headline":"User Files","description":"A wiki of Machine learning and Statistics resources useful for self-learning.","@type":"WebPage","url":"http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/User-Files/","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> Tristan-MP Documentation </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/README/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/GettingStarted/outline/" class="nav-list-link">Getting Started</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/GettingStarted/Logging-in-to-perseus/" class="nav-list-link">Logging into Perseus</a></li><li class="nav-list-item "><a href="http://localhost:4000/GettingStarted/Downloading-and-Compiling-Tristan/" class="nav-list-link">Compiling Tristan-MP</a></li><li class="nav-list-item "><a href="http://localhost:4000/GettingStarted/Running-your-first-Tristan-MP-simulation/" class="nav-list-link">Running Tristan-MP</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/AnalyzingSims/outline/" class="nav-list-link">Analyzing Simulations</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/AnalyzingSims/Logging-in-to-tigressdata2/" class="nav-list-link">Logging into TigressData2</a></li><li class="nav-list-item "><a href="http://localhost:4000/AnalyzingSims/Writing-your-own-python-scripts/" class="nav-list-link">Writing a python analysis script</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/Example%20Simulations/outline/" class="nav-list-link">Example Simulations</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/Example%20Simulations/Sample-Weibel-run/" class="nav-list-link">Weibel Simulation</a></li><li class="nav-list-item "><a href="http://localhost:4000/Example%20Simulations/Sample-shock-run/" class="nav-list-link">Shock Simulation</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/outline/" class="nav-list-link">Tristan-MP Features and Code Structure</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/Code-Features/" class="nav-list-link">Code Features</a></li><li class="nav-list-item "><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/Input-Files/" class="nav-list-link">Input Files</a></li><li class="nav-list-item active"><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/User-Files/" class="nav-list-link active">User Files</a></li><li class="nav-list-item "><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/Compilation/" class="nav-list-link">Compiling Tristan</a></li><li class="nav-list-item "><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/Running/" class="nav-list-link">Running Tristan</a></li></ul></li><li class="nav-list-item"><a href="http://localhost:4000/User%20Manual/User-Manual/" class="nav-list-link">User Manual</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/RunningOnOtherClusters/outline/" class="nav-list-link">Running On Other HPC Clusters</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/RunningOnOtherClusters/nersc/" class="nav-list-link">Nersc Cori</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Tristan-MP Documentation" aria-label="Search Tristan-MP Documentation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/Tristan-MP%20Features%20And%20Code%20Structure/outline/">Tristan-MP Features and Code Structure</a></li> <li class="breadcrumb-nav-list-item"><span>User Files</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h2 id="user-file"> <a href="#user-file" aria-labelledby="user-file" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> User file </h2> <p>The user file, <code class="language-plaintext highlighter-rouge">user_*.F90</code>, such as <code class="language-plaintext highlighter-rouge">user_shock.F90</code> or <code class="language-plaintext highlighter-rouge">user_weibel.F90</code>, is used for readily expanding the behavior of the code without having to alter any of the code-flow logic. The user defines routines for loading and injecting particles here, as well special boundary conditions on fields and particles (e.g. reflecting walls) and external fields.</p> <div class="language-fortran highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">subroutine</span><span class="w"> </span><span class="n">get_external_fields</span><span class="w">
</span></code></pre></div></div> <p>This subroutine compute external magnetic fields to be added to the particle mover. These fields do not evolve via Maxwell equations. Note that it uses local coordinates corresponding to different CPU, so one should convert that to global coordinates first.</p> <p><strong>Example:</strong> This example sets an external <code class="language-plaintext highlighter-rouge">B_z</code> field, that is an <code class="language-plaintext highlighter-rouge">bz_ext0*sin(x)*sin(y)</code> function of global coordinate x and y.</p> <div class="language-fortran highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">subroutine</span><span class="w"> </span><span class="n">get_external_fields</span><span class="w">
  </span><span class="kt">real</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="k">inout</span><span class="p">)::</span><span class="w"> </span><span class="n">bx_ext</span><span class="p">,</span><span class="n">by_ext</span><span class="p">,</span><span class="n">bz_ext</span><span class="p">,</span><span class="w"> </span><span class="n">ex_ext</span><span class="p">,</span><span class="w"> </span><span class="n">ey_ext</span><span class="p">,</span><span class="w"> </span><span class="n">ez_ext</span><span class="w">
  </span><span class="kt">real</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="k">in</span><span class="p">)::</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="w">
  </span><span class="n">ex_ext</span><span class="o">=</span><span class="mf">0.</span><span class="w">
  </span><span class="n">ey_ext</span><span class="o">=</span><span class="mf">0.</span><span class="w">
  </span><span class="n">ez_ext</span><span class="o">=</span><span class="mf">0.</span><span class="w">
  </span><span class="n">bx_ext</span><span class="o">=</span><span class="mf">0.</span><span class="w">
  </span><span class="n">by_ext</span><span class="o">=</span><span class="mf">0.</span><span class="w">
  </span><span class="n">bz_ext</span><span class="o">=</span><span class="n">bz_ext0</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">y</span><span class="o">+</span><span class="nb">modulo</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span><span class="n">sizey</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">myall</span><span class="mi">-5</span><span class="p">))</span><span class="w">
  </span><span class="c1">!bz_0 is defined in the input reading part above,</span><span class="w">
  </span><span class="c1">!note the coordinate transformation rule.</span><span class="w">
</span><span class="k">end</span><span class="w"> </span><span class="k">subroutine</span><span class="w"> </span><span class="n">get_external_fields</span><span class="w">
</span></code></pre></div></div> <div class="language-fortran highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">subroutine</span><span class="w"> </span><span class="n">init_EMfields_user</span><span class="p">()</span><span class="w">
</span></code></pre></div></div> <p>This subroutine sets the electromagnetic fields of any specific user purpose.</p> <p><strong>Example:</strong> This example sets an initial jump for in-plane magnetic field by. Also component perpendicular to interface surface <code class="language-plaintext highlighter-rouge">bx</code> is added.</p> <div class="language-fortran highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">subroutine</span><span class="w"> </span><span class="n">init_EMfields_user</span><span class="p">()</span><span class="w">
  </span><span class="kt">integer</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">jglob</span><span class="p">,</span><span class="w"> </span><span class="n">kglob</span><span class="w">
  </span><span class="c1">!initialize B field to be set by Binit and the inclination angle</span><span class="w">
  </span><span class="c1">!-- used for shock problems</span><span class="w">
  </span><span class="n">Binit</span><span class="o">=</span><span class="nb">sqrt</span><span class="p">((</span><span class="n">gamma0</span><span class="p">)</span><span class="o">*</span><span class="n">ppc0</span><span class="o">*</span><span class="mf">.5</span><span class="o">*</span><span class="n">c2</span><span class="o">*</span><span class="p">(</span><span class="n">mi</span><span class="o">+</span><span class="n">me</span><span class="p">)</span><span class="o">*</span><span class="n">sigma</span><span class="p">)</span><span class="w">
  </span><span class="k">do</span><span class="w"> </span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">mz</span><span class="w">
    </span><span class="k">do</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">my</span><span class="w">
      </span><span class="k">do</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">mx</span><span class="w">
        </span><span class="n">jglob</span><span class="o">=</span><span class="n">j</span><span class="o">+</span><span class="nb">modulo</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span><span class="n">sizey</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">myall</span><span class="mi">-5</span><span class="p">)</span><span class="w">
        </span><span class="c1">!global j,k coords are defined from local ones</span><span class="w">
        </span><span class="n">kglob</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="p">(</span><span class="n">rank</span><span class="p">/</span><span class="n">sizey</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">mzall</span><span class="mi">-5</span><span class="p">)</span><span class="w">
        </span><span class="c1">!magnetic fields components are initialized</span><span class="w">
        </span><span class="n">bx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">Binit</span><span class="w">
        </span><span class="n">bz</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span><span class="o">*</span><span class="n">Binit</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">btheta</span><span class="p">)</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">bphi</span><span class="p">)</span><span class="w">
        </span><span class="n">by</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">=</span><span class="mf">2.</span><span class="o">*</span><span class="n">Binit</span><span class="o">*</span><span class="nb">tanh</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="n">mx</span><span class="p">/</span><span class="mi">2</span><span class="p">)/</span><span class="mf">4.</span><span class="p">)</span><span class="w">
        </span><span class="n">ex</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span><span class="w"> </span><span class="c1">!electric field is initialized</span><span class="w">
        </span><span class="n">ey</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">=</span><span class="mf">0.</span><span class="w">
        </span><span class="n">ez</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">=</span><span class="mf">-0.</span><span class="w">
      </span><span class="k">enddo</span><span class="w">
    </span><span class="k">enddo</span><span class="w">
  </span><span class="k">enddo</span><span class="w">
</span><span class="k">end</span><span class="w"> </span><span class="k">subroutine</span><span class="w"> </span><span class="n">init_EMfields_user</span><span class="w">
</span></code></pre></div></div> <hr> <footer> <p class="text-small text-grey-dk-000 mb-0">Website compiled by <a href="https://www.linkedin.com/in/patrick-crumley/">Patrick Crumley</a>. Please feel free to contribute on <a href="https://github.com/pcrumley/ml_stat_resources">GitHub.</a></p> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
